<!-- Tool: Interest Calculator | Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ§Ø¦Ø¯ -->
<div class="tool-card">
  <div class="tool-header">
    <div class="tool-icon">ðŸ’°</div>
    <div>
      <h1 class="tool-title">{{tool.name}}</h1>
      <p class="tool-description">{{tool.description}}</p>
    </div>
  </div>
  
  <!-- Simple Interest Section -->
  <div class="interest-section">
    <h3 class="section-title">ðŸ“Š {{tool.simpleInterest}}</h3>
    <div class="calc-row-inline">
      <span class="calc-label">{{tool.principal}}</span>
      <input type="number" class="calc-input-sm" id="simple-principal" placeholder="10000" oninput="calcSimple()">
      <span class="calc-label">Ã— {{tool.rate}}</span>
      <input type="number" class="calc-input-sm" id="simple-rate" placeholder="5" oninput="calcSimple()">
      <span class="calc-label">% Ã— {{tool.time}}</span>
      <input type="number" class="calc-input-sm" id="simple-time" placeholder="3" oninput="calcSimple()">
    </div>
    <div class="results-row">
      <div class="result-box">
        <span class="result-label">{{tool.totalInterest}}</span>
        <span class="calc-result" id="simple-interest">â€”</span>
        <div class="result-controls">
          <button class="ctrl-btn" onclick="adjustPrecision('simple-interest', -1)">âˆ’</button>
          <button class="ctrl-btn" onclick="adjustPrecision('simple-interest', 1)">+</button>
          <button class="ctrl-btn" onclick="copyResult('simple-interest')">ðŸ“‹</button>
        </div>
      </div>
      <div class="result-box">
        <span class="result-label">{{tool.totalAmount}}</span>
        <span class="calc-result increase" id="simple-total">â€”</span>
        <div class="result-controls">
          <button class="ctrl-btn" onclick="adjustPrecision('simple-total', -1)">âˆ’</button>
          <button class="ctrl-btn" onclick="adjustPrecision('simple-total', 1)">+</button>
          <button class="ctrl-btn" onclick="copyResult('simple-total')">ðŸ“‹</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Compound Interest Section -->
  <div class="interest-section">
    <h3 class="section-title">ðŸ“ˆ {{tool.compoundInterest}}</h3>
    <div class="calc-row-inline">
      <span class="calc-label">{{tool.principal}}</span>
      <input type="number" class="calc-input-sm" id="compound-principal" placeholder="1000" oninput="calcCompound()">
      <span class="calc-label">Ã— {{tool.rate}}</span>
      <input type="number" class="calc-input-sm" id="compound-rate" placeholder="5" oninput="calcCompound()">
      <span class="calc-label">% Ã— {{tool.time}}</span>
      <input type="number" class="calc-input-sm" id="compound-time" placeholder="10" oninput="calcCompound()">
    </div>
    <div class="calc-row-inline">
      <span class="calc-label">{{tool.compound}}</span>
      <select class="calc-select" id="compound-frequency" onchange="calcCompound()">
        <option value="1">{{tool.yearly}}</option>
        <option value="2">{{tool.halfYearly}}</option>
        <option value="4">{{tool.quarterly}}</option>
        <option value="12" selected>{{tool.monthly}}</option>
        <option value="365">{{tool.daily}}</option>
      </select>
    </div>
    
    <!-- Main Results -->
    <div class="main-results" id="main-results" style="display: none;">
      <div class="big-result">
        <span class="big-result-label">{{tool.totalAmount}}</span>
        <div class="big-result-row">
          <span class="big-result-value" id="compound-total-big">â€”</span>
          <button class="copy-big-btn" onclick="copyBigResult()" title="{{tool.copy}}">ðŸ“‹</button>
        </div>
      </div>
      <div class="sub-results">
        <div class="sub-result">
          <span class="sub-label">{{tool.totalInterest}}</span>
          <span class="sub-value interest-color" id="compound-interest-display">â€”</span>
        </div>
        <div class="sub-result">
          <span class="sub-label">{{tool.principal}}</span>
          <span class="sub-value" id="compound-principal-display">â€”</span>
        </div>
      </div>
      
      <!-- Export Buttons -->
      <div class="export-buttons">
        <button class="export-btn" onclick="exportToExcel()">
          <span class="btn-icon">ðŸ“Š</span>
          <span>{{tool.exportExcel}}</span>
        </button>
        <button class="export-btn secondary" onclick="copyAllData()">
          <span class="btn-icon">ðŸ“‹</span>
          <span>{{tool.copyAll}}</span>
        </button>
      </div>
    </div>
    
    <!-- Chart -->
    <div class="chart-container" id="chart-container" style="display: none;">
      <canvas id="growth-chart"></canvas>
    </div>
    
    <!-- Yearly Table -->
    <div class="table-container" id="table-container" style="display: none;">
      <table class="data-table">
        <thead>
          <tr>
            <th>{{tool.year}}</th>
            <th>{{tool.startBalance}}</th>
            <th>{{tool.yearlyInterest}}</th>
            <th>{{tool.accumulatedInterest}}</th>
            <th>{{tool.endBalance}}</th>
          </tr>
        </thead>
        <tbody id="yearly-table-body">
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- How to Use -->
<div class="how-to-use">
  <h3>ðŸ“– {{ui.howToUse}}</h3>
  <p>{{tool.howToUseText}}</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

<style>
.interest-section {
  background: var(--bg-tertiary);
  border-radius: var(--border-radius-lg);
  padding: 24px;
  margin-bottom: 20px;
}

.section-title {
  margin: 0 0 20px 0;
  font-size: 1.2rem;
  color: var(--text-primary);
}

.calc-row-inline {
  display: flex;
  align-items: baseline;
  gap: 8px;
  flex-wrap: wrap;
  padding: 16px 0;
  font-size: 1.15rem;
  line-height: 2.2;
}

.calc-label {
  color: var(--text-primary);
}

.calc-input-sm {
  width: 100px;
  padding: 4px 8px;
  background: transparent;
  border: none;
  border-bottom: 2px solid var(--accent-primary);
  border-radius: 0;
  color: var(--accent-primary);
  font-size: 1.15rem;
  font-weight: 600;
  font-family: inherit;
  text-align: center;
  transition: all var(--transition-fast);
}

.calc-input-sm:focus {
  outline: none;
  border-bottom-color: var(--accent-secondary);
  background: rgba(99, 102, 241, 0.05);
}

.calc-input-sm::placeholder {
  color: var(--text-muted);
  font-weight: 400;
}

.calc-select {
  padding: 8px 16px;
  background: var(--bg-secondary);
  border: 2px solid var(--border-color);
  border-radius: var(--border-radius);
  color: var(--text-primary);
  font-size: 1rem;
  font-family: inherit;
  cursor: pointer;
  transition: all var(--transition-fast);
}

.calc-select:focus {
  outline: none;
  border-color: var(--accent-primary);
}

.results-row {
  display: flex;
  gap: 20px;
  margin-top: 20px;
  flex-wrap: wrap;
}

.result-box {
  flex: 1;
  min-width: 200px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 16px;
  background: var(--bg-secondary);
  border-radius: var(--border-radius);
}

.result-label {
  font-size: 0.9rem;
  color: var(--text-secondary);
}

.calc-result {
  min-width: 60px;
  padding: 8px 16px;
  background: var(--accent-gradient);
  border-radius: var(--border-radius);
  color: white;
  font-size: 1.3rem;
  font-weight: 700;
  text-align: center;
}

.calc-result.increase {
  background: linear-gradient(135deg, #22c55e, #16a34a);
}

.result-controls {
  display: flex;
  gap: 4px;
  justify-content: center;
}

.ctrl-btn {
  width: 28px;
  height: 28px;
  border: none;
  border-radius: 6px;
  background: var(--bg-tertiary);
  color: var(--text-secondary);
  font-size: 1rem;
  cursor: pointer;
  transition: all var(--transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
}

.ctrl-btn:hover {
  background: var(--accent-primary);
  color: white;
}

/* Main Results Display */
.main-results {
  margin-top: 24px;
  padding: 24px;
  background: var(--bg-secondary);
  border-radius: var(--border-radius-lg);
  text-align: center;
}

.big-result {
  margin-bottom: 16px;
}

.big-result-label {
  display: block;
  font-size: 0.95rem;
  color: var(--text-secondary);
  margin-bottom: 8px;
}

.big-result-value {
  font-size: 2.5rem;
  font-weight: 800;
  background: linear-gradient(135deg, #22c55e, #16a34a);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.sub-results {
  display: flex;
  justify-content: center;
  gap: 40px;
  padding-top: 16px;
  border-top: 1px solid var(--border-color);
}

.sub-result {
  text-align: center;
}

.sub-label {
  display: block;
  font-size: 0.85rem;
  color: var(--text-muted);
  margin-bottom: 4px;
}

.sub-value {
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--text-primary);
}

.sub-value.interest-color {
  color: #22c55e;
}

/* Big Result Copy Button */
.big-result-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
}

.copy-big-btn {
  width: 40px;
  height: 40px;
  border: none;
  border-radius: 50%;
  background: var(--bg-tertiary);
  color: var(--text-secondary);
  font-size: 1.2rem;
  cursor: pointer;
  transition: all var(--transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
}

.copy-big-btn:hover {
  background: var(--accent-primary);
  color: white;
  transform: scale(1.1);
}

/* Export Buttons */
.export-buttons {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-top: 20px;
  padding-top: 20px;
  border-top: 1px solid var(--border-color);
}

.export-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 24px;
  border: none;
  border-radius: var(--border-radius);
  background: linear-gradient(135deg, #22c55e, #16a34a);
  color: white;
  font-size: 0.95rem;
  font-weight: 600;
  font-family: inherit;
  cursor: pointer;
  transition: all var(--transition-fast);
}

.export-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
}

.export-btn.secondary {
  background: var(--accent-gradient);
}

.export-btn.secondary:hover {
  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
}

.btn-icon {
  font-size: 1.1rem;
}

/* Chart */
.chart-container {
  margin-top: 24px;
  padding: 20px;
  background: var(--bg-secondary);
  border-radius: var(--border-radius-lg);
  height: 320px;
}

/* Table */
.table-container {
  margin-top: 24px;
  overflow-x: auto;
  border-radius: var(--border-radius-lg);
  max-height: 400px;
  overflow-y: auto;
}

.data-table {
  width: 100%;
  border-collapse: collapse;
  background: var(--bg-secondary);
  font-size: 0.95rem;
}

.data-table th,
.data-table td {
  padding: 12px 16px;
  text-align: center;
  border-bottom: 1px solid var(--border-color);
}

.data-table th {
  background: var(--accent-primary);
  color: white;
  font-weight: 600;
  position: sticky;
  top: 0;
  z-index: 1;
}

.data-table tbody tr:hover {
  background: var(--bg-tertiary);
}

.data-table td:first-child {
  font-weight: 600;
  color: var(--accent-primary);
}

.data-table td:last-child {
  font-weight: 700;
  color: var(--text-primary);
}

.interest-cell {
  color: #22c55e !important;
}

@media (max-width: 768px) {
  .calc-input-sm {
    width: 80px;
    font-size: 1rem;
  }
  
  .result-box {
    min-width: 150px;
  }
  
  .calc-result {
    font-size: 1.1rem;
  }
  
  .big-result-value {
    font-size: 2rem;
  }
  
  .sub-results {
    gap: 20px;
  }
  
  .data-table {
    font-size: 0.8rem;
  }
  
  .data-table th,
  .data-table td {
    padding: 8px 6px;
  }
  
  .chart-container {
    height: 250px;
  }
  
  .export-buttons {
    flex-direction: column;
    gap: 10px;
  }
  
  .export-btn {
    width: 100%;
    justify-content: center;
  }
}
</style>

<script>
// Store precision for each result
const interestData = {
  'simple-interest': { raw: null, precision: 2 },
  'simple-total': { raw: null, precision: 2 },
  'compound-interest': { raw: null, precision: 2 },
  'compound-total': { raw: null, precision: 2 }
};

let growthChart = null;
let yearlyDataCache = [];  // Store yearly data for export

function formatNumber(num, precision) {
  if (num === null || isNaN(num)) return 'â€”';
  return num.toFixed(precision);
}

function formatCurrency(num) {
  if (num === null || isNaN(num)) return 'â€”';
  return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function updateResult(id) {
  const data = interestData[id];
  const el = document.getElementById(id);
  if (el) el.textContent = formatNumber(data.raw, data.precision);
}

function adjustPrecision(id, delta) {
  const data = interestData[id];
  if (data.raw === null) return;
  data.precision = Math.max(0, Math.min(10, data.precision + delta));
  updateResult(id);
}

function copyResult(id) {
  const data = interestData[id];
  if (data.raw === null) return;
  navigator.clipboard.writeText(data.raw.toFixed(data.precision)).then(() => {
    App.showToast(App.state.lang === 'ar' ? 'ØªÙ… Ø§Ù„Ù†Ø³Ø®!' : 'Copied!');
  });
}

// Simple Interest: I = P Ã— r Ã— t
function calcSimple() {
  const P = parseFloat(document.getElementById('simple-principal').value);
  const r = parseFloat(document.getElementById('simple-rate').value) / 100;
  const t = parseFloat(document.getElementById('simple-time').value);
  
  if (!isNaN(P) && !isNaN(r) && !isNaN(t)) {
    const interest = P * r * t;
    const total = P + interest;
    
    interestData['simple-interest'].raw = interest;
    interestData['simple-total'].raw = total;
  } else {
    interestData['simple-interest'].raw = null;
    interestData['simple-total'].raw = null;
  }
  
  updateResult('simple-interest');
  updateResult('simple-total');
}

// Compound Interest: A = P Ã— (1 + r)^(nÃ—t)
function calcCompound() {
  const P = parseFloat(document.getElementById('compound-principal').value);
  const r = parseFloat(document.getElementById('compound-rate').value) / 100;
  const t = parseInt(document.getElementById('compound-time').value);
  const n = parseFloat(document.getElementById('compound-frequency').value);
  
  if (!isNaN(P) && !isNaN(r) && !isNaN(t) && !isNaN(n) && P > 0 && t > 0) {
    const total = P * Math.pow(1 + r, n * t);
    const interest = total - P;
    
    interestData['compound-interest'].raw = interest;
    interestData['compound-total'].raw = total;
    
    // Update main display
    document.getElementById('main-results').style.display = 'block';
    document.getElementById('compound-total-big').textContent = '$' + formatCurrency(total);
    document.getElementById('compound-interest-display').textContent = '$' + formatCurrency(interest);
    document.getElementById('compound-principal-display').textContent = '$' + formatCurrency(P);
    
    // Generate yearly data and update chart/table
    generateYearlyData(P, r, n, t);
    
    document.getElementById('chart-container').style.display = 'block';
    document.getElementById('table-container').style.display = 'block';
  } else {
    interestData['compound-interest'].raw = null;
    interestData['compound-total'].raw = null;
    
    document.getElementById('main-results').style.display = 'none';
    document.getElementById('chart-container').style.display = 'none';
    document.getElementById('table-container').style.display = 'none';
  }
}

function generateYearlyData(P, r, n, years) {
  const yearlyData = [];
  let balance = P;
  let totalInterest = 0;
  
  for (let year = 1; year <= years; year++) {
    const startBalance = balance;
    const periodsThisYear = n;
    const endBalance = startBalance * Math.pow(1 + r, periodsThisYear);
    const yearInterest = endBalance - startBalance;
    totalInterest += yearInterest;
    
    yearlyData.push({
      year,
      startBalance,
      yearInterest,
      totalInterest,
      endBalance
    });
    
    balance = endBalance;
  }
  
  yearlyDataCache = yearlyData;  // Cache for export
  
  updateChart(yearlyData, P);
  updateTable(yearlyData);
}

function updateChart(data, principal) {
  const ctx = document.getElementById('growth-chart').getContext('2d');
  
  const labels = data.map(d => d.year);
  const balances = data.map(d => d.endBalance);
  const principalLine = data.map(() => principal);
  
  if (growthChart) {
    growthChart.destroy();
  }
  
  const isArabic = App.state.lang === 'ar';
  const textColor = getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim() || '#333';
  const mutedColor = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary').trim() || '#666';
  
  growthChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [
        {
          label: isArabic ? 'Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ' : 'End Balance',
          data: balances,
          backgroundColor: 'rgba(34, 197, 94, 0.8)',
          borderColor: 'rgba(34, 197, 94, 1)',
          borderWidth: 1,
          borderRadius: 6,
          order: 2
        },
        {
          label: isArabic ? 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ' : 'Principal',
          data: principalLine,
          type: 'line',
          borderColor: 'rgba(99, 102, 241, 1)',
          borderWidth: 2,
          borderDash: [5, 5],
          fill: false,
          pointRadius: 0,
          order: 1
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom',
          rtl: isArabic,
          labels: {
            color: textColor,
            padding: 20,
            font: { family: 'inherit' }
          }
        },
        tooltip: {
          rtl: isArabic,
          callbacks: {
            label: function(context) {
              return context.dataset.label + ': $' + context.raw.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            }
          }
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            text: isArabic ? 'Ø§Ù„Ø³Ù†Ø©' : 'Year',
            color: mutedColor
          },
          grid: { display: false },
          ticks: { color: mutedColor }
        },
        y: {
          title: {
            display: true,
            text: isArabic ? 'Ø§Ù„Ù…Ø¨Ù„Øº ($)' : 'Amount ($)',
            color: mutedColor
          },
          ticks: {
            color: mutedColor,
            callback: function(value) {
              if (value >= 1000000) return '$' + (value/1000000).toFixed(1) + 'M';
              if (value >= 1000) return '$' + (value/1000).toFixed(0) + 'K';
              return '$' + value.toLocaleString();
            }
          }
        }
      }
    }
  });
}

function updateTable(data) {
  const tbody = document.getElementById('yearly-table-body');
  tbody.innerHTML = '';
  
  data.forEach(row => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${row.year}</td>
      <td>$${formatCurrency(row.startBalance)}</td>
      <td class="interest-cell">$${formatCurrency(row.yearInterest)}</td>
      <td class="interest-cell">$${formatCurrency(row.totalInterest)}</td>
      <td>$${formatCurrency(row.endBalance)}</td>
    `;
    tbody.appendChild(tr);
  });
}

// Copy big result
function copyBigResult() {
  const total = interestData['compound-total'].raw;
  if (total === null) return;
  
  navigator.clipboard.writeText(total.toFixed(2)).then(() => {
    App.showToast(App.state.lang === 'ar' ? 'ØªÙ… Ø§Ù„Ù†Ø³Ø®!' : 'Copied!');
  });
}

// Export to Excel
function exportToExcel() {
  if (yearlyDataCache.length === 0) return;
  
  const isArabic = App.state.lang === 'ar';
  const P = parseFloat(document.getElementById('compound-principal').value);
  const r = parseFloat(document.getElementById('compound-rate').value);
  const t = parseInt(document.getElementById('compound-time').value);
  const freq = document.getElementById('compound-frequency');
  const freqText = freq.options[freq.selectedIndex].text;
  
  // Summary data
  const summaryData = [
    [isArabic ? 'Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©' : 'Compound Interest Calculator'],
    [],
    [isArabic ? 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ' : 'Principal', P],
    [isArabic ? 'Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØ§Ø¦Ø¯Ø©' : 'Interest Rate', r + '%'],
    [isArabic ? 'Ø§Ù„Ù…Ø¯Ø© (Ø³Ù†ÙˆØ§Øª)' : 'Time (years)', t],
    [isArabic ? 'Ø§Ù„ØªØ±ÙƒÙŠØ¨' : 'Compound', freqText],
    [],
    [isArabic ? 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ' : 'Total Amount', interestData['compound-total'].raw],
    [isArabic ? 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§Ø¦Ø¯Ø©' : 'Total Interest', interestData['compound-interest'].raw],
    [],
    []
  ];
  
  // Table headers
  const headers = isArabic 
    ? ['Ø§Ù„Ø³Ù†Ø©', 'Ø±ØµÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©', 'Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©', 'Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…Ø©', 'Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ']
    : ['Year', 'Start Balance', 'Yearly Interest', 'Accumulated Interest', 'End Balance'];
  
  // Table data
  const tableData = yearlyDataCache.map(row => [
    row.year,
    row.startBalance,
    row.yearInterest,
    row.totalInterest,
    row.endBalance
  ]);
  
  // Combine all data
  const allData = [...summaryData, headers, ...tableData];
  
  // Create workbook
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.aoa_to_sheet(allData);
  
  // Set column widths
  ws['!cols'] = [
    { wch: 12 },
    { wch: 18 },
    { wch: 18 },
    { wch: 20 },
    { wch: 18 }
  ];
  
  // Format numbers as currency (starting from row 12)
  const startRow = summaryData.length + 1;
  for (let i = 0; i < yearlyDataCache.length; i++) {
    const rowNum = startRow + i + 1;
    ['B', 'C', 'D', 'E'].forEach(col => {
      const cell = ws[col + rowNum];
      if (cell) {
        cell.z = '$#,##0.00';
      }
    });
  }
  
  XLSX.utils.book_append_sheet(wb, ws, isArabic ? 'Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©' : 'Compound Interest');
  
  // Download
  const fileName = isArabic ? 'Ø­Ø§Ø³Ø¨Ø©_Ø§Ù„ÙØ§Ø¦Ø¯Ø©_Ø§Ù„Ù…Ø±ÙƒØ¨Ø©.xlsx' : 'compound_interest_calculator.xlsx';
  XLSX.writeFile(wb, fileName);
  
  App.showToast(isArabic ? 'ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±!' : 'Exported!');
}

// Copy all data to clipboard
function copyAllData() {
  if (yearlyDataCache.length === 0) return;
  
  const isArabic = App.state.lang === 'ar';
  const P = parseFloat(document.getElementById('compound-principal').value);
  const r = parseFloat(document.getElementById('compound-rate').value);
  const t = parseInt(document.getElementById('compound-time').value);
  const freq = document.getElementById('compound-frequency');
  const freqText = freq.options[freq.selectedIndex].text;
  
  let text = '';
  
  // Title and summary
  text += (isArabic ? 'Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©\n' : 'Compound Interest Calculator\n');
  text += 'â•'.repeat(40) + '\n\n';
  
  text += (isArabic ? 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ: ' : 'Principal: ') + '$' + formatCurrency(P) + '\n';
  text += (isArabic ? 'Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØ§Ø¦Ø¯Ø©: ' : 'Interest Rate: ') + r + '%\n';
  text += (isArabic ? 'Ø§Ù„Ù…Ø¯Ø©: ' : 'Time: ') + t + (isArabic ? ' Ø³Ù†ÙˆØ§Øª\n' : ' years\n');
  text += (isArabic ? 'Ø§Ù„ØªØ±ÙƒÙŠØ¨: ' : 'Compound: ') + freqText + '\n\n';
  
  text += 'â•'.repeat(40) + '\n';
  text += (isArabic ? 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ' : 'Total Amount: ') + '$' + formatCurrency(interestData['compound-total'].raw) + '\n';
  text += (isArabic ? 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§Ø¦Ø¯Ø©: ' : 'Total Interest: ') + '$' + formatCurrency(interestData['compound-interest'].raw) + '\n';
  text += 'â•'.repeat(40) + '\n\n';
  
  // Table
  const headers = isArabic 
    ? ['Ø§Ù„Ø³Ù†Ø©', 'Ø±ØµÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©', 'Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©', 'Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…Ø©', 'Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ']
    : ['Year', 'Start Balance', 'Yearly Interest', 'Accumulated', 'End Balance'];
  
  text += headers.join('\t') + '\n';
  text += 'â”€'.repeat(60) + '\n';
  
  yearlyDataCache.forEach(row => {
    text += [
      row.year,
      '$' + formatCurrency(row.startBalance),
      '$' + formatCurrency(row.yearInterest),
      '$' + formatCurrency(row.totalInterest),
      '$' + formatCurrency(row.endBalance)
    ].join('\t') + '\n';
  });
  
  navigator.clipboard.writeText(text).then(() => {
    App.showToast(isArabic ? 'ØªÙ… Ù†Ø³Ø® ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!' : 'All data copied!');
  });
}
</script>
