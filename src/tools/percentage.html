<!-- Tool: Percentage Calculator | Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© -->
<div class="tool-card">
  <div class="tool-header">
    <div class="tool-icon">ðŸ”¢</div>
    <div>
      <h1 class="tool-title">{{tool.name}}</h1>
      <p class="tool-description">{{tool.description}}</p>
    </div>
  </div>
  
  <!-- Calculator 1: What is X% of Y? -->
  <div class="calc-row-inline">
    <span class="calc-label">{{tool.whatIsPercent}}</span>
    <input type="number" class="calc-input-sm" id="calc1-percent" placeholder="10" oninput="calculate(1)">
    <span class="calc-label">{{tool.percentOf}}</span>
    <input type="number" class="calc-input-sm" id="calc1-number" placeholder="200" oninput="calculate(1)">
    <span class="calc-label">=</span>
    <span class="calc-result" id="result1">â€”</span>
    <div class="result-controls">
      <button class="ctrl-btn" onclick="adjustPrecision(1, -1)">âˆ’</button>
      <button class="ctrl-btn" onclick="adjustPrecision(1, 1)">+</button>
      <button class="ctrl-btn" onclick="copyResult(1)">ðŸ“‹</button>
    </div>
  </div>
  
  <!-- Calculator 2: X is what % of Y? -->
  <div class="calc-row-inline">
    <input type="number" class="calc-input-sm" id="calc2-part" placeholder="25" oninput="calculate(2)">
    <span class="calc-label">{{tool.isWhatPercent}}</span>
    <input type="number" class="calc-input-sm" id="calc2-whole" placeholder="200" oninput="calculate(2)">
    <span class="calc-label">=</span>
    <span class="calc-result" id="result2">â€”</span>
    <div class="result-controls">
      <button class="ctrl-btn" onclick="adjustPrecision(2, -1)">âˆ’</button>
      <button class="ctrl-btn" onclick="adjustPrecision(2, 1)">+</button>
      <button class="ctrl-btn" onclick="copyResult(2)">ðŸ“‹</button>
    </div>
  </div>
  
  <!-- Calculator 3: Percentage Change -->
  <div class="calc-row-inline">
    <span class="calc-label">{{tool.percentChange}} {{tool.from}}</span>
    <input type="number" class="calc-input-sm" id="calc3-from" placeholder="100" oninput="calculate(3)">
    <span class="calc-label">{{tool.to}}</span>
    <input type="number" class="calc-input-sm" id="calc3-to" placeholder="150" oninput="calculate(3)">
    <span class="calc-label">=</span>
    <span class="calc-result" id="result3">â€”</span>
    <div class="result-controls">
      <button class="ctrl-btn" onclick="adjustPrecision(3, -1)">âˆ’</button>
      <button class="ctrl-btn" onclick="adjustPrecision(3, 1)">+</button>
      <button class="ctrl-btn" onclick="copyResult(3)">ðŸ“‹</button>
    </div>
  </div>
  
  <!-- Calculator 4: Discount -->
  <div class="calc-row-inline">
    <span class="calc-label">{{tool.originalPrice}}</span>
    <input type="number" class="calc-input-sm" id="calc4-price" placeholder="500" oninput="calculate(4)">
    <span class="calc-label">âˆ’ {{tool.discount}}</span>
    <input type="number" class="calc-input-sm" id="calc4-discount" placeholder="20" oninput="calculate(4)">
    <span class="calc-label">% =</span>
    <span class="calc-result" id="result4">â€”</span>
    <div class="result-controls">
      <button class="ctrl-btn" onclick="adjustPrecision(4, -1)">âˆ’</button>
      <button class="ctrl-btn" onclick="adjustPrecision(4, 1)">+</button>
      <button class="ctrl-btn" onclick="copyResult(4)">ðŸ“‹</button>
    </div>
  </div>
  
  <!-- Calculator 5: Add percentage to number -->
  <div class="calc-row-inline">
    <input type="number" class="calc-input-sm" id="calc5-number" placeholder="200" oninput="calculate(5)">
    <span class="calc-label">+</span>
    <input type="number" class="calc-input-sm" id="calc5-percent" placeholder="15" oninput="calculate(5)">
    <span class="calc-label">% =</span>
    <span class="calc-result" id="result5">â€”</span>
    <div class="result-controls">
      <button class="ctrl-btn" onclick="adjustPrecision(5, -1)">âˆ’</button>
      <button class="ctrl-btn" onclick="adjustPrecision(5, 1)">+</button>
      <button class="ctrl-btn" onclick="copyResult(5)">ðŸ“‹</button>
    </div>
  </div>
  
  <!-- Calculator 6: Original price before discount -->
  <div class="calc-row-inline">
    <span class="calc-label">{{tool.afterDiscount}}</span>
    <input type="number" class="calc-input-sm" id="calc6-discount" placeholder="20" oninput="calculate(6)">
    <span class="calc-label">% {{tool.priceBecame}}</span>
    <input type="number" class="calc-input-sm" id="calc6-final" placeholder="80" oninput="calculate(6)">
    <span class="calc-label">{{tool.originalWas}}</span>
    <span class="calc-result" id="result6">â€”</span>
    <div class="result-controls">
      <button class="ctrl-btn" onclick="adjustPrecision(6, -1)">âˆ’</button>
      <button class="ctrl-btn" onclick="adjustPrecision(6, 1)">+</button>
      <button class="ctrl-btn" onclick="copyResult(6)">ðŸ“‹</button>
    </div>
  </div>
  
  <!-- Calculator 7: Profit/Loss percentage -->
  <div class="calc-row-inline">
    <span class="calc-label">{{tool.buyPrice}}</span>
    <input type="number" class="calc-input-sm" id="calc7-buy" placeholder="100" oninput="calculate(7)">
    <span class="calc-label">{{tool.sellPrice}}</span>
    <input type="number" class="calc-input-sm" id="calc7-sell" placeholder="130" oninput="calculate(7)">
    <span class="calc-label">=</span>
    <span class="calc-result" id="result7">â€”</span>
    <div class="result-controls">
      <button class="ctrl-btn" onclick="adjustPrecision(7, -1)">âˆ’</button>
      <button class="ctrl-btn" onclick="adjustPrecision(7, 1)">+</button>
      <button class="ctrl-btn" onclick="copyResult(7)">ðŸ“‹</button>
    </div>
  </div>
</div>

<!-- How to Use -->
<div class="how-to-use">
  <h3>ðŸ“– {{ui.howToUse}}</h3>
  <p>{{tool.howToUseText}}</p>
</div>

<style>
.calc-row-inline {
  display: flex;
  align-items: baseline;
  gap: 8px;
  flex-wrap: wrap;
  padding: 20px 24px;
  background: var(--bg-tertiary);
  border-radius: var(--border-radius-lg);
  margin-bottom: 16px;
  font-size: 1.15rem;
  line-height: 2.2;
  width: 100%;
}

.calc-label {
  color: var(--text-primary);
}

.calc-input-sm {
  width: 90px;
  padding: 4px 8px;
  background: transparent;
  border: none;
  border-bottom: 2px solid var(--accent-primary);
  border-radius: 0;
  color: var(--accent-primary);
  font-size: 1.15rem;
  font-weight: 600;
  font-family: inherit;
  text-align: center;
  transition: all var(--transition-fast);
}

.calc-input-sm:focus {
  outline: none;
  border-bottom-color: var(--accent-secondary);
  background: rgba(99, 102, 241, 0.05);
}

.calc-input-sm::placeholder {
  color: var(--text-muted);
  font-weight: 400;
}

.calc-result {
  min-width: 60px;
  padding: 4px 12px;
  background: var(--accent-gradient);
  border-radius: var(--border-radius);
  color: white;
  font-size: 1.15rem;
  font-weight: 700;
  text-align: center;
  transition: all var(--transition-fast);
}

.calc-result.increase {
  background: linear-gradient(135deg, #22c55e, #16a34a);
}

.calc-result.decrease {
  background: linear-gradient(135deg, #ef4444, #dc2626);
}

.result-controls {
  display: flex;
  gap: 4px;
  align-items: center;
  margin-inline-start: auto;
}

.ctrl-btn {
  width: 28px;
  height: 28px;
  border: none;
  border-radius: 6px;
  background: var(--bg-secondary);
  color: var(--text-secondary);
  font-size: 1rem;
  cursor: pointer;
  transition: all var(--transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
}

.ctrl-btn:hover {
  background: var(--accent-primary);
  color: white;
}

.ctrl-btn:active {
  transform: scale(0.95);
}

@media (max-width: 768px) {
  .calc-row-inline {
    justify-content: center;
    font-size: 1rem;
  }
  
  .calc-input-sm {
    width: 70px;
    font-size: 1rem;
  }
  
  .calc-result {
    font-size: 1rem;
  }
  
  .ctrl-btn {
    width: 26px;
    height: 26px;
    font-size: 0.9rem;
  }
}
</style>

<script>
// Store raw results and precision for each calculator
const calcData = {
  1: { raw: null, precision: null, maxPrecision: 10, isPercent: false },
  2: { raw: null, precision: null, maxPrecision: 10, isPercent: true },
  3: { raw: null, precision: null, maxPrecision: 10, isPercent: true, signed: true },
  4: { raw: null, precision: null, maxPrecision: 10, isPercent: false },
  5: { raw: null, precision: null, maxPrecision: 10, isPercent: false },
  6: { raw: null, precision: null, maxPrecision: 10, isPercent: false },
  7: { raw: null, precision: null, maxPrecision: 10, isPercent: true, signed: true }
};

// Get actual decimal places of a number
function getDecimalPlaces(num) {
  if (Number.isInteger(num)) return 0;
  const str = num.toString();
  if (str.includes('e')) {
    // Handle scientific notation
    return Math.min(10, parseInt(str.split('e-')[1]) || 10);
  }
  const decimalPart = str.split('.')[1];
  return decimalPart ? Math.min(decimalPart.length, 10) : 0;
}

// Format number based on precision
function formatResult(calcId) {
  const data = calcData[calcId];
  const resultEl = document.getElementById('result' + calcId);
  
  if (data.raw === null || isNaN(data.raw)) {
    resultEl.textContent = 'â€”';
    resultEl.className = 'calc-result';
    return;
  }
  
  // Use actual precision if not manually set
  const precision = data.precision !== null ? data.precision : getDecimalPlaces(data.raw);
  
  let formatted;
  
  if (precision === 0 && Number.isInteger(data.raw)) {
    formatted = data.raw.toString();
  } else {
    formatted = data.raw.toFixed(precision);
    // Remove trailing zeros only if precision was auto-detected
    if (data.precision === null) {
      formatted = parseFloat(formatted).toString();
    }
  }
  
  // Add sign for signed results
  if (data.signed && data.raw > 0) {
    formatted = '+' + formatted;
  }
  
  // Add percent symbol
  if (data.isPercent) {
    formatted += '%';
  }
  
  resultEl.textContent = formatted;
  
  // Set color for signed results
  if (data.signed) {
    resultEl.className = 'calc-result ' + (data.raw >= 0 ? 'increase' : 'decrease');
  }
}

// Adjust precision
function adjustPrecision(calcId, delta) {
  const data = calcData[calcId];
  if (data.raw === null) return;
  
  // Initialize precision if not set
  if (data.precision === null) {
    data.precision = getDecimalPlaces(data.raw);
  }
  
  data.precision = Math.max(0, Math.min(data.maxPrecision, data.precision + delta));
  formatResult(calcId);
}

// Copy result
function copyResult(calcId) {
  const data = calcData[calcId];
  if (data.raw === null || isNaN(data.raw)) return;
  
  const precision = data.precision !== null ? data.precision : getDecimalPlaces(data.raw);
  const text = data.raw.toFixed(precision);
  
  navigator.clipboard.writeText(text).then(() => {
    App.showToast(App.state.lang === 'ar' ? 'ØªÙ… Ø§Ù„Ù†Ø³Ø®!' : 'Copied!');
  });
}

// Main calculate function
function calculate(calcId) {
  let result = null;
  
  switch(calcId) {
    case 1: {
      const percent = parseFloat(document.getElementById('calc1-percent').value);
      const number = parseFloat(document.getElementById('calc1-number').value);
      if (!isNaN(percent) && !isNaN(number)) {
        result = (percent / 100) * number;
      }
      break;
    }
    case 2: {
      const part = parseFloat(document.getElementById('calc2-part').value);
      const whole = parseFloat(document.getElementById('calc2-whole').value);
      if (!isNaN(part) && !isNaN(whole) && whole !== 0) {
        result = (part / whole) * 100;
      }
      break;
    }
    case 3: {
      const from = parseFloat(document.getElementById('calc3-from').value);
      const to = parseFloat(document.getElementById('calc3-to').value);
      if (!isNaN(from) && !isNaN(to) && from !== 0) {
        result = ((to - from) / Math.abs(from)) * 100;
      }
      break;
    }
    case 4: {
      const price = parseFloat(document.getElementById('calc4-price').value);
      const discount = parseFloat(document.getElementById('calc4-discount').value);
      if (!isNaN(price) && !isNaN(discount)) {
        result = price - (price * discount / 100);
      }
      break;
    }
    case 5: {
      const number = parseFloat(document.getElementById('calc5-number').value);
      const percent = parseFloat(document.getElementById('calc5-percent').value);
      if (!isNaN(number) && !isNaN(percent)) {
        result = number + (number * percent / 100);
      }
      break;
    }
    case 6: {
      const discount = parseFloat(document.getElementById('calc6-discount').value);
      const finalPrice = parseFloat(document.getElementById('calc6-final').value);
      if (!isNaN(discount) && !isNaN(finalPrice) && discount !== 100) {
        result = finalPrice / (1 - discount / 100);
      }
      break;
    }
    case 7: {
      const buyPrice = parseFloat(document.getElementById('calc7-buy').value);
      const sellPrice = parseFloat(document.getElementById('calc7-sell').value);
      if (!isNaN(buyPrice) && !isNaN(sellPrice) && buyPrice !== 0) {
        result = ((sellPrice - buyPrice) / buyPrice) * 100;
      }
      break;
    }
  }
  
  // Reset precision when new calculation
  calcData[calcId].raw = result;
  calcData[calcId].precision = null;
  formatResult(calcId);
}
</script>
